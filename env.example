# Greengage DB Exporter - Environment Variables Example
# Copy this file to .env and customize for your environment

# ============================================================================
# HTTP Server Configuration
# ============================================================================
HTTP_PORT=8080
HTTPS_PORT=8443

# ============================================================================
# Logging Configuration
# ============================================================================
# Options: TRACE, DEBUG, INFO, WARN, ERROR
LOG_LEVEL=INFO

# ============================================================================
# Database Connection Configuration
# ============================================================================
# Primary Greengage/PostgreSQL Database
DB_JDBC_URL=jdbc:postgresql://localhost:5432/postgres?sslmode=disable
DB_USER=gpadmin
DB_PASSWORD=

# Connection Pool Settings
DB_POOL_MAX=5
DB_POOL_MIN=1
DB_POOL_INIT=1

# Connection Timeouts (supports: s=seconds, m=minutes, h=hours)
DB_CONN_TIMEOUT=5s
DB_IDLE_TIMEOUT=10m
DB_MAX_LIFETIME=30m
DB_VALIDATION_INTERVAL=2m

# ============================================================================
# Scrape Configuration
# ============================================================================
# How often to collect metrics (supports: s, m, h)
SCRAPE_INTERVAL=15s

# Timeout for each collection cycle
SCRAPE_TIMEOUT=10s

# ============================================================================
# Orchestrator Configuration
# ============================================================================
# Maximum age of cached results before considered stale
ORCHESTRATOR_CACHE_MAX_AGE=30s

# Connection retry settings
ORCHESTRATOR_RETRY_ATTEMPTS=3
ORCHESTRATOR_RETRY_DELAY=1s

# Circuit breaker settings
ORCHESTRATOR_FAILURE_THRESHOLD=3
ORCHESTRATOR_CIRCUIT_BREAKER=true

# ============================================================================
# Metrics Exposition
# ============================================================================
# HTTP path for Prometheus metrics
METRICS_PATH=/metrics

# ============================================================================
# Banner Configuration
# ============================================================================
BANNER_WIDTH=60

# ============================================================================
# Collector Enable/Disable Flags
# ============================================================================

# Core Collectors
COLLECTOR_CLUSTER_STATE_ENABLED=true
COLLECTOR_SEGMENT_ENABLED=true
COLLECTOR_CONNECTIONS_ENABLED=true
COLLECTOR_LOCKS_ENABLED=true
COLLECTOR_EXTENDED_LOCKS_ENABLED=true
COLLECTOR_DATABASE_SIZE_ENABLED=true
COLLECTOR_REPLICATION_MONITOR_ENABLED=true
COLLECTOR_TABLE_HEALTH_ENABLED=true

# Host Resource Collectors
COLLECTOR_SPILL_PER_HOST_ENABLED=true
COLLECTOR_DISK_PER_HOST_ENABLED=true
COLLECTOR_RSG_PER_HOST_ENABLED=true

# Query Collectors
COLLECTOR_ACTIVE_QUERY_DURATION_ENABLED=true

# Vacuum Collectors
COLLECTOR_TABLE_VACUUM_STATS_ENABLED=true
COLLECTOR_TABLE_VACUUM_TUPLE_THRESHOLD=1000
COLLECTOR_DB_VACUUM_STATS_ENABLED=true
COLLECTOR_VACUUM_RUNNING_ENABLED=true

# Backup Collectors (requires GPBackup history database)
COLLECTOR_GP_BACKUP_HISTORY_ENABLED=false
GPBACKUP_HISTORY_JDBC_URL=jdbc:sqlite:/data1/master/gpseg-1/gpbackup_history.db

# ============================================================================
# Per-Database Collection Configuration
# ============================================================================
# Mode: all, include, exclude, none
COLLECTOR_PER_DB_MODE=all

# Comma-separated list of databases (used with include/exclude mode)
# Example: "mydb1,mydb2,mydb3"
COLLECTOR_PER_DB_LIST="postgres"

# Enable connection caching for per-database collectors
COLLECTOR_PER_DB_CACHE_ENABLED=true

# ============================================================================
# Example Configurations
# ============================================================================

# Example 1: Monitor only specific databases
# COLLECTOR_PER_DB_MODE=include
# COLLECTOR_PER_DB_LIST="production_db,analytics_db"

# Example 2: Exclude system/template databases
# COLLECTOR_PER_DB_MODE=exclude
# COLLECTOR_PER_DB_LIST="template0,template1,postgres"

# Example 3: Disable per-database metrics entirely
# COLLECTOR_PER_DB_MODE=none

# Example 4: Reduce load on large clusters
# SCRAPE_INTERVAL=60s
# COLLECTOR_TABLE_HEALTH_ENABLED=false
# COLLECTOR_EXTENDED_LOCKS_ENABLED=false
# COLLECTOR_TABLE_VACUUM_TUPLE_THRESHOLD=10000

# Example 5: High-frequency monitoring for troubleshooting
# SCRAPE_INTERVAL=5s
# LOG_LEVEL=DEBUG

